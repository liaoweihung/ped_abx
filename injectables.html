<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å°å…’é‡åŠ‘æŠ—ç”Ÿç´ é€Ÿç®—</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#27ae60">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        body { font-family: "Microsoft JhengHei", -apple-system, sans-serif; background-color: #f4f7f6; margin: 0; padding: 0; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: white; min-height: 100vh; display: flex; flex-direction: column; }
        
        /* ç¶ è‰²ç³»ä»£è¡¨é‡åŠ‘/åš´è‚… */
        header { background: #27ae60; color: white; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        header h2 { margin: 0; font-size: 18px; display: flex; align-items: center; justify-content: center; gap: 8px; }

        .content { padding: 15px; flex: 1; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #2c3e50; font-size: 15px; }
        select, input { width: 100%; padding: 12px; border: 1px solid #bdc3c7; border-radius: 8px; font-size: 16px; background: #fff; box-sizing: border-box; }
        select:focus, input:focus { border-color: #27ae60; outline: none; }

        .calc-btn { width: 100%; padding: 14px; background: #e67e22; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 0 #d35400; }
        .calc-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #d35400; }

        /* çµæœå¡ç‰‡ */
        .result-card { background-color: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 0; margin-top: 25px; display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.05); overflow: hidden; }
        .res-header { padding: 10px 15px; font-weight: bold; color: white; background-color: #27ae60; display: flex; justify-content: space-between; align-items: center; }
        
        .res-body { padding: 15px; }
        .res-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px dashed #eee; padding-bottom: 10px; }
        .res-label { font-size: 14px; color: #7f8c8d; }
        .res-val { font-size: 20px; font-weight: bold; color: #333; }
        .res-unit { font-size: 14px; color: #666; }

        /* è­¦ç¤ºå€ */
        .alert-box { background: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 10px; margin: 15px; border-radius: 5px; font-size: 14px; display: none; }
        .danger-box { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 10px; margin: 15px; border-radius: 5px; font-size: 14px; display: none; font-weight: bold; }

        /* ä»¿å–®èªªæ˜ */
        .guide-box { margin-top: 20px; font-size: 13px; line-height: 1.6; color: #555; background: #f9f9f9; padding: 15px; border-radius: 8px; border-left: 5px solid #27ae60; }
        .guide-title { font-weight: bold; color: #27ae60; margin-bottom: 5px; display: block; font-size: 14px; }

        footer { text-align: center; padding: 20px; background: #eee; font-size: 12px; color: #aaa; margin-top: auto; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h2>ğŸ’‰ å°å…’é‡åŠ‘æŠ—ç”Ÿç´ é€Ÿç®—</h2>
    </header>

    <div class="content">
        <div class="form-group">
            <label for="drug">é¸æ“‡æ³¨å°„è—¥å“ (Vial/Amp)</label>
            <select id="drug" onchange="hideResult()">
                </select>
        </div>

        <div class="form-group">
            <label for="weight">é«”é‡ (kg)</label>
            <input type="number" id="weight" placeholder="è¼¸å…¥é«”é‡" step="0.1" inputmode="decimal">
        </div>

        <div class="form-group">
            <label for="age">å¹´é½¡ (æ­²)</label>
            <input type="number" id="age" placeholder="é¸å¡« (éƒ¨åˆ†è—¥å“éœ€åˆ¤æ–·å¹´é½¡)" inputmode="decimal">
        </div>

        <button class="calc-btn" onclick="calculate()">è¨ˆç®—å»ºè­°åŠ‘é‡</button>

        <div id="result-card" class="result-card">
            <div class="res-header">
                <span>å»ºè­°åŠ‘é‡ç¯„åœ</span>
                <small id="res-drug-name">Drug Name</small>
            </div>
            
            <div class="res-body">
                <div class="res-row">
                    <span class="res-label">è¨ˆç®—æ¨™æº–</span>
                    <span class="res-val" style="font-size:16px" id="res-basis">--</span>
                </div>

                <div class="res-row">
                    <span class="res-label">å»ºè­°å–®æ¬¡åŠ‘é‡</span>
                    <div>
                        <span class="res-val" id="res-single">--</span>
                        <span class="res-unit">mg</span>
                    </div>
                </div>

                <div class="res-row">
                    <span class="res-label">æ¯æ—¥ç¸½é‡</span>
                    <div>
                        <span class="res-val" id="res-daily">--</span>
                        <span class="res-unit">mg/day</span>
                    </div>
                </div>

                <div class="res-row" style="border-bottom:none;">
                    <span class="res-label">å»ºè­°é »æ¬¡</span>
                    <span class="res-val" style="color:#2980b9" id="res-freq">--</span>
                </div>
            </div>
        </div>

        <div id="danger-msg" class="danger-box"></div>
        <div id="alert-msg" class="alert-box"></div>

        <div id="guide-box" class="guide-box" style="display:none;">
            <span class="guide-title">ğŸ“– ä»¿å–®èˆ‡è‡¨åºŠå»ºè­°</span>
            <div id="guide-text"></div>
        </div>

    </div>

    <footer>
        è³‡æ–™ä¾†æºï¼šè—¥å“ä»¿å–®èˆ‡è‡¨åºŠæŒ‡å¼•æ•´ç† (2025/12/26)
    </footer>
</div>

<script>
    /* Data Logic:
       min/max: mg/kg per unit
       unit: 'day' (daily total) or 'dose' (per single dose)
       freq: text string
    */
    const drugs = [
        { group: 'Penicillins', id: 'amp', name: 'Ampicillin', min: 25, max: 60, unit: 'day', freq: 'Q6H', desc: 'ä¸€èˆ¬å…’ç«¥(<20kg)ï¼š25-60 mg/kg/dayã€‚è…¦è†œç‚ï¼š100-200 mg/kg/dayã€‚æ–°ç”Ÿå…’å¯ç”¨ã€‚' },
        { group: 'Penicillins', id: 'oxa', name: 'Oxacillin', min: 50, max: 100, unit: 'day', freq: 'Q6H', desc: '<40kgï¼š50 mg/kg/dayï¼Œåš´é‡å¯é” 100 mg/kg/dayã€‚æ—©ç”¢/æ–°ç”Ÿå…’ï¼š25 mg/kg/dayã€‚' },
        { group: 'Penicillins', id: 'unasyn', name: 'Unasyn (Amp/Sulb)', min: 150, max: 150, unit: 'day', freq: 'Q6H-Q8H', desc: 'å­©ç«¥/å¬°å…’ï¼š150 mg/kg/day (å«Amp 100 + Sulb 50)ï¼Œåˆ†3-4æ¬¡ã€‚æ–°ç”Ÿå…’(7å¤©å…§)ï¼š75 mg/kg/dayã€‚' },
        { group: 'Penicillins', id: 'aug_iv', name: 'Augmentin IV', min: 30, max: 30, unit: 'dose', freq: 'Q8H', desc: '3å€‹æœˆ-12æ­²ï¼š30 mg/kg/dose Q8Hã€‚0-3å€‹æœˆï¼š30 mg/kg/dose Q12Hã€‚' },
        
        { group: 'Cephalosporins', id: 'cefazolin', name: 'Cefazolin (1ä»£)', min: 20, max: 50, unit: 'day', freq: 'Q8H', desc: 'å…’ç«¥ï¼š20-50 mg/kg/day (é‡ç—‡å¯é” 100 mg/kg/day)ã€‚' },
        { group: 'Cephalosporins', id: 'cefmetazole', name: 'Cefmetazole (2ä»£)', min: 25, max: 100, unit: 'day', freq: 'Q8H', desc: 'å…’ç«¥ï¼š25-100 mg/kg/day åˆ†æ¬¡çµ¦äºˆã€‚' },
        { group: 'Cephalosporins', id: 'brosym', name: 'Brosym (Cefoper/Sulb)', min: 40, max: 80, unit: 'day', freq: 'Q6H-Q12H', desc: '40-80 mg/kg/day (å…©æˆåˆ†ç¸½é‡)ï¼Œåˆ†2-4æ¬¡ã€‚åš´é‡å¯é” 160 mg/kg/dayã€‚' },
        { group: 'Cephalosporins', id: 'ceftazidime', name: 'Ceftazidime (3ä»£)', min: 30, max: 100, unit: 'day', freq: 'Q8H', desc: '>2å€‹æœˆï¼š30-100 mg/kg/day (åˆ†2-3æ¬¡)ã€‚è…¦è†œç‚å¯é” 150 mg/kg/day (Max 6g)ã€‚æ–°ç”Ÿå…’ï¼š25-60 mg/kg/dayã€‚' },
        { group: 'Cephalosporins', id: 'ceftriaxone', name: 'Ceftriaxone (Rocephin)', min: 20, max: 80, unit: 'day', freq: 'QD-BID', danger: 'ğŸˆ² ç¦ç”¨æ–¼é«˜è†½ç´…ç´ æ–°ç”Ÿå…’/æ—©ç”¢å…’ã€‚ğŸˆ² ä¸å¯èˆ‡å«éˆ£æº¶æ¶²(Ringer)ä½µç”¨(è‡´æ­»é¢¨éšª)ã€‚', desc: '15å¤©-12æ­²ï¼š20-80 mg/kg/dayã€‚æ–°ç”Ÿå…’(<14å¤©)ï¼š20-50 mg/kg/dayã€‚' },
        { group: 'Cephalosporins', id: 'zinforo', name: 'Zinforo (Ceftaroline)', min: 8, max: 12, unit: 'dose', freq: 'Q8H', note: 'âš ï¸ éœ€ä¾å¹´é½¡: 2æœˆ-2æ­² 8mg/kg; 2æ­²-12æ­² 12mg/kg', desc: '5ä»£é ­å­¢ã€‚2æœˆ-2æ­²ï¼š8 mg/kg Q8Hã€‚2æ­²-12æ­²ï¼š12 mg/kg Q8Hã€‚é’å°‘å¹´ï¼š600 mg Q12Hã€‚' },
        { group: 'Cephalosporins', id: 'zavicefta', name: 'Zavicefta (Caz/Avi)', min: 40, max: 50, unit: 'dose', freq: 'Q8H', note: 'âš ï¸ éœ€ä¾å¹´é½¡: 3-6å€‹æœˆ 40mg/kg; 6å€‹æœˆä»¥ä¸Š 50mg/kg', desc: '6æœˆ-18æ­²ï¼š50 mg/kg/dose Q8Hã€‚3æœˆ-6æœˆï¼š40 mg/kg/dose Q8Hã€‚' },

        { group: 'Carbapenems', id: 'mepem', name: 'Meropenem', min: 10, max: 20, unit: 'dose', freq: 'Q8H', desc: '>3å€‹æœˆï¼š10-20 mg/kg Q8Hã€‚è…¦è†œç‚/åš´é‡ï¼š40 mg/kg Q8Hã€‚' },
        { group: 'Carbapenems', id: 'tienam', name: 'Imipenem/Cilastatin', min: 15, max: 15, unit: 'dose', freq: 'Q6H', desc: '>3å€‹æœˆä¸”<40kgï¼š15 mg/kg Q6H (Max 2g/day)ã€‚âŒ ä¸å»ºè­°ç”¨æ–¼è…¦è†œç‚ã€‚' },

        { group: 'Anti-MRSA', id: 'vanco', name: 'Vancomycin', min: 40, max: 40, unit: 'day', freq: 'Q6H-Q8H', desc: 'å…’ç«¥ï¼š40 mg/kg/dayã€‚æ–°ç”Ÿå…’èµ·å§‹ 10-15 mg/kgã€‚éœ€TDMã€‚' },
        { group: 'Anti-MRSA', id: 'teicoplanin', name: 'Teicoplanin', min: 6, max: 10, unit: 'dose', freq: 'QD (Loading Q12H)', desc: '>2å€‹æœˆï¼šLoading 10 mg/kg Q12H x3ã€‚Maintenance 6-10 mg/kg QDã€‚' },
        { group: 'Anti-MRSA', id: 'cubicin', name: 'Daptomycin', min: 5, max: 12, unit: 'dose', freq: 'QD', danger: 'ğŸˆ² åš´ç¦ä½¿ç”¨æ–¼ < 1æ­²å¬°å…’ (ç¥ç¶“è‚Œè‚‰é¢¨éšª)', desc: '1-6æ­²ï¼š9-12 mg/kg QDã€‚7-17æ­²ï¼š5-7 mg/kg QDã€‚' },
        { group: 'Anti-MRSA', id: 'zyvox', name: 'Linezolid', min: 10, max: 10, unit: 'dose', freq: 'Q8H', desc: 'å‡ºç”Ÿ-11æ­²ï¼š10 mg/kg Q8Hã€‚12æ­²ä»¥ä¸Šï¼š600 mg Q12Hã€‚' },

        { group: 'Others', id: 'gentamicin', name: 'Gentamicin', min: 2, max: 2.5, unit: 'dose', freq: 'Q8H', note: 'è¨ˆç®—ä»¥ 6-7.5 mg/kg/day åˆ†ä¸‰åŠ‘ç‚ºä¾‹', desc: 'å°å…’ï¼š2.0-2.5 mg/kg Q8H (Total 6-7.5 mg/kg/day)ã€‚å…·è€³/è…æ¯’æ€§ã€‚' },
        { group: 'Others', id: 'amikacin', name: 'Amikacin', min: 15, max: 15, unit: 'day', freq: 'QD-BID', desc: 'å…’ç«¥ï¼š15 mg/kg/dayã€‚æ–°ç”Ÿå…’ï¼šèµ·å§‹ 10mg/kg æ¥çºŒ 7.5mg/kg Q12Hã€‚' },
        { group: 'Others', id: 'cipro', name: 'Ciprofloxacin', min: 6, max: 10, unit: 'dose', freq: 'Q8H', danger: 'âš ï¸ é™åˆ¶ä½¿ç”¨ï¼šå…’ç«¥å¯èƒ½å¼•èµ·é—œç¯€è»Ÿéª¨ç—…è®Š', desc: 'é™ç”¨æ–¼è¤‡é›œæ€§UTI(6-10 mg/kg Q8H)æˆ–å›Šè…«çº–ç¶­åŒ–(10 mg/kg Q8H)æˆ–ç‚­ç–½ç—…ã€‚' },
        { group: 'Others', id: 'levo', name: 'Levofloxacin', min: 0, max: 0, unit: 'day', freq: '--', danger: 'ğŸˆ² ä»¿å–®åˆ—ç‚ºå…’ç«¥ç¦å¿Œ (é—œç¯€ç—…è®Š)', desc: 'å®‰å…¨æ€§æœªç¢ºç«‹ï¼Œä¾ä»¿å–®å±¬ç¦å¿Œã€‚åƒ…åœ¨ç„¡è—¥å¯ç”¨ä¸”åˆ©å¤§æ–¼å¼Šæ™‚è€ƒæ…®ã€‚' }
    ];

    function init() {
        const select = document.getElementById('drug');
        let currentGroup = '';
        drugs.forEach((d, idx) => {
            if (d.group !== currentGroup) {
                const grp = document.createElement('optgroup');
                grp.label = d.group;
                select.appendChild(grp);
                currentGroup = d.group;
            }
            const opt = document.createElement('option');
            opt.value = idx;
            opt.text = d.name;
            select.appendChild(opt);
        });
    }

    function hideResult() {
        document.getElementById('result-card').style.display = 'none';
        document.getElementById('danger-msg').style.display = 'none';
        document.getElementById('alert-msg').style.display = 'none';
        document.getElementById('guide-box').style.display = 'none';
    }

    function calculate() {
        const weight = parseFloat(document.getElementById('weight').value);
        const age = parseFloat(document.getElementById('age').value);
        const drugIdx = document.getElementById('drug').value;
        const drug = drugs[drugIdx];

        if (!weight || weight <= 0) { alert('è«‹è¼¸å…¥æœ‰æ•ˆé«”é‡'); return; }

        // ç‰¹æ®Šè—¥å“é‚è¼¯
        let calcMin = drug.min;
        let calcMax = drug.max;
        
        // Ceftaroline (Zinforo)
        if (drug.id === 'zinforo') {
            if (!age && age !== 0) { alert('Zinforo è«‹è¼¸å…¥å¹´é½¡'); return; }
            if (age < 0.16) { alert('Zinforo < 2å€‹æœˆä¸å»ºè­°ä½¿ç”¨'); return; } // 2m = 0.16y
            if (age < 2) { calcMin = 8; calcMax = 8; }
            else if (age <= 12) { calcMin = 12; calcMax = 12; }
            else { alert('12æ­²ä»¥ä¸Šå»ºè­°æˆäººåŠ‘é‡'); return; }
        }
        // Zavicefta
        if (drug.id === 'zavicefta') {
            if (!age && age !== 0) { alert('Zavicefta è«‹è¼¸å…¥å¹´é½¡'); return; }
            if (age < 0.25) { alert('Zavicefta < 3å€‹æœˆä¸å»ºè­°ä½¿ç”¨'); return; } // 3m = 0.25y
            if (age < 0.5) { calcMin = 40; calcMax = 40; } // 3-6m
            else { calcMin = 50; calcMax = 50; } // >6m
        }
        // Daptomycin
        if (drug.id === 'cubicin') {
            if (age < 1) { 
                document.getElementById('danger-msg').innerText = drug.danger;
                document.getElementById('danger-msg').style.display = 'block';
                return; // ç¦æ­¢è¨ˆç®—
            }
            if (age <= 6) { calcMin = 9; calcMax = 12; }
            else { calcMin = 5; calcMax = 7; }
        }

        // é–‹å§‹è¨ˆç®—
        let dailyMin = 0, dailyMax = 0;
        let singleMin = 0, singleMax = 0;
        let basisText = "";

        // åˆ¤æ–·è—¥å“æ˜¯ä»¥ "æ¯åŠ‘" é‚„æ˜¯ "æ¯å¤©" ç‚ºå–®ä½
        let freqNum = 1;
        if (drug.freq.includes('Q6H')) freqNum = 4;
        else if (drug.freq.includes('Q8H')) freqNum = 3;
        else if (drug.freq.includes('Q12H') || drug.freq.includes('BID')) freqNum = 2;
        else if (drug.freq.includes('QD')) freqNum = 1;

        if (drug.unit === 'day') {
            // åŸºç¤æ˜¯ mg/kg/day
            dailyMin = weight * calcMin;
            dailyMax = weight * calcMax;
            singleMin = dailyMin / freqNum;
            singleMax = dailyMax / freqNum;
            basisText = `${calcMin}-${calcMax} mg/kg/day`;
        } else {
            // åŸºç¤æ˜¯ mg/kg/dose
            singleMin = weight * calcMin;
            singleMax = weight * calcMax;
            dailyMin = singleMin * freqNum;
            dailyMax = singleMax * freqNum;
            basisText = `${calcMin}-${calcMax} mg/kg/dose`;
        }

        // æ¸²æŸ“çµæœ
        document.getElementById('res-drug-name').innerText = drug.name;
        document.getElementById('res-basis').innerText = basisText;
        
        // æ ¼å¼åŒ–æ•¸å­—
        const fmt = (n) => Number.isInteger(n) ? n : n.toFixed(1);
        document.getElementById('res-single').innerText = `${fmt(singleMin)} ~ ${fmt(singleMax)}`;
        document.getElementById('res-daily').innerText = `${fmt(dailyMin)} ~ ${fmt(dailyMax)}`;
        document.getElementById('res-freq').innerText = drug.freq;

        document.getElementById('result-card').style.display = 'block';

        // é¡¯ç¤ºè­¦èª
        const dangerDiv = document.getElementById('danger-msg');
        if (drug.danger) {
            dangerDiv.innerText = drug.danger;
            dangerDiv.style.display = 'block';
        } else {
            dangerDiv.style.display = 'none';
        }

        const alertDiv = document.getElementById('alert-msg');
        if (drug.note) {
            alertDiv.innerText = drug.note;
            alertDiv.style.display = 'block';
        } else {
            alertDiv.style.display = 'none';
        }

        // é¡¯ç¤ºä»¿å–®
        document.getElementById('guide-text').innerText = drug.desc;
        document.getElementById('guide-box').style.display = 'block';
    }

    // Run Init
    init();

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
    }
</script>

</body>
</html>