<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å°å…’æŠ—ç”Ÿç´ é€Ÿç®— </title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2980b9">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        body { font-family: "Microsoft JhengHei", -apple-system, sans-serif; background-color: #f4f7f6; margin: 

0; padding: 0; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: white; min-height: 100vh; display: flex; 

flex-direction: column; }
        
        header { background: #2980b9; color: white; padding: 15px; text-align: center; box-shadow: 0 2px 5px 

rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        header h2 { margin: 0; font-size: 18px; display: flex; align-items: center; justify-content: center; gap: 

8px; }

        .content { padding: 15px; flex: 1; }

        .tab-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { 
            flex: 1; padding: 12px; border: 1px solid #bdc3c7; background: #ecf0f1; color: #7f8c8d; 
            font-size: 16px; font-weight: bold; border-radius: 8px; cursor: pointer; transition: 0.2s;
        }
        .tab-btn.active { background: #3498db; color: white; border-color: #3498db; box-shadow: 0 3px 6px rgba

(52, 152, 219, 0.3); }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #2c3e50; font-size: 

15px; }
        select, input { width: 100%; padding: 12px; border: 1px solid #bdc3c7; border-radius: 8px; font-size: 

16px; background: #fff; box-sizing: border-box; }
        select:focus, input:focus { border-color: #3498db; outline: none; }

        /* ç‰¹æ®Šæ¨£å¼ï¼šå¹´é½¡èˆ‡ä¼°ç®—æŒ‰éˆ•ä½µæ’ */
        .age-row { display: flex; gap: 10px; align-items: flex-end; }
        .age-input-group { flex: 1; }
        .estimate-btn { padding: 12px 10px; background-color: #17a2b8; color: white; border: none; border-radius: 

8px; cursor: pointer; font-size: 14px; height: 46px; white-space: nowrap; }
        
        .calc-btn { width: 100%; padding: 14px; background: #e67e22; color: white; border: none; border-radius: 

8px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 0 #d35400; }
        .calc-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #d35400; }

        .result-card { background-color: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 0; 

margin-top: 25px; display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.05); overflow: hidden; }
        .res-header { padding: 10px 15px; font-weight: bold; color: white; display: flex; justify-content: 

space-between; align-items: center; }
        .res-hosp { background-color: #7f8c8d; }
        .res-assoc { background-color: #2980b9; }

        .res-body { padding: 15px; display: flex; align-items: baseline; justify-content: space-between; }
        .res-val { font-size: 32px; font-weight: bold; color: #333; }
        .res-unit { font-size: 16px; color: #666; margin-left: 5px; }
        .res-freq { background: #eee; padding: 4px 10px; border-radius: 15px; font-size: 14px; font-weight: bold; 

color: #555; }

        .guide-box { margin-top: 20px; font-size: 13px; line-height: 1.5; color: #555; }
        .guide-item { margin-bottom: 15px; padding: 10px; background: #f9f9f9; border-left: 4px solid #ccc; 

border-radius: 4px; }
        .guide-title { display: block; font-weight: bold; margin-bottom: 5px; color: #333; }
        .guide-hosp-border { border-left-color: #7f8c8d; }
        .guide-assoc-border { border-left-color: #2980b9; background-color: #eaf2f8; }
        .note-warning { color: #c0392b; font-weight: bold; margin-top: 5px; font-size: 14px; display: block; 

padding: 0 15px 15px 15px; }

        /* ä¼°ç®—æç¤ºæ–‡å­— */
        #estimate-msg { font-size: 13px; color: #17a2b8; margin-top: 5px; display: none; }

        footer { text-align: center; padding: 20px; background: #eee; font-size: 12px; color: #aaa; margin-top: 

auto; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h2>
            <img src="icon.png" style="width: 28px; height: 28px; border-radius: 50%;" 

onerror="this.style.display='none'">
            å°å…’æŠ—ç”Ÿç´ é€Ÿç®—
        </h2>
    </header>

    <div class="content">
        <div class="tab-group">
            <button class="tab-btn active" onclick="switchTab('susp')">ğŸ’§ æ°´åŠ‘ (Susp)</button>
            <button class="tab-btn" onclick="switchTab('pow')">ğŸ’Š ç£¨ç²‰ (Cap/Tab)</button>
        </div>

        <div class="form-group">
            <label for="drug">é¸æ“‡è—¥å“</label>
            <select id="drug" onchange="hideResult()"></select>
        </div>

        <div class="form-group">
            <label for="age">å¹´é½¡ (æ­²)</label>
            <div class="age-row">
                <div class="age-input-group">
                    <input type="number" id="age" placeholder="ä¾‹å¦‚ 5" inputmode="decimal">
                </div>
                <button class="estimate-btn" onclick="estimateWeight()">å¸¶å…¥æ¨™æº–é«”é‡</button>
            </div>
            <div id="estimate-msg"></div>
        </div>

        <div class="form-group">
            <label for="weight">é«”é‡ (kg)</label>
            <input type="number" id="weight" placeholder="è¼¸å…¥æˆ–è‡ªå‹•ä¼°ç®—" step="0.1" inputmode="decimal">
        </div>

        <button class="calc-btn" onclick="calculate()">è¨ˆç®—å»ºè­°åŠ‘é‡</button>

        <div id="results-container">
            <div id="res-card-hosp" class="result-card">
                <div class="res-header res-hosp">
                    <span>ğŸ¥ é™¢å…§å»ºè­°</span>
                    <small>Hospital Std.</small>
                </div>
                <div class="res-body">
                    <div><span class="res-val" id="val-hosp">--</span><span class="res-unit" id="unit-

hosp">mL</span></div>
                    <div class="res-freq" id="freq-hosp">--</div>
                </div>
            </div>

            <div id="res-card-assoc" class="result-card" style="display:none;">
                <div class="res-header res-assoc">
                    <span>â˜… å…’ç§‘é†«å­¸æœƒå»ºè­° (2018)</span>
                    <small>High Dose</small>
                </div>
                <div class="res-body">
                    <div><span class="res-val" id="val-assoc">--</span><span class="res-unit" id="unit-

assoc">mL</span></div>
                    <div class="res-freq" id="freq-assoc">--</div>
                </div>
                <span id="warning-assoc" class="note-warning"></span>
            </div>

            <div class="guide-box" id="guide-container" style="display:none;">
                <div class="guide-item guide-assoc-border" id="text-assoc-box" style="display:none;">
                    <span class="guide-title" style="color:#2980b9">å…’ç§‘é†«å­¸æœƒå»ºè­°</span>
                    <span id="text-assoc"></span>
                </div>
                <div class="guide-item guide-hosp-border">
                    <span class="guide-title" style="color:#7f8c8d">é™¢å…§å»ºè­°åŠ‘é‡</span>
                    <span id="text-hosp"></span>
                </div>
            </div>
        </div>
    </div>

    <footer>
        é«”é‡ä¼°ç®—ä¾æ“šï¼šè¡›ç¦éƒ¨ç”Ÿé•·æ›²ç·š (50th Percentile)
    </footer>
</div>

<script>
    // å°ç£å…’ç«¥ç”Ÿé•·æ›²ç·š 50th ç™¾åˆ†ä½åƒè€ƒæ•¸æ“š (kg)
    const growthChart = {
        0.5: 7.5, // 6å€‹æœˆ
        1: 9.5,
        2: 12.0,
        3: 14.5,
        4: 16.5,
        5: 18.5,
        6: 21.0,
        7: 24.0,
        8: 27.0,
        9: 30.5,
        10: 34.0,
        11: 38.5,
        12: 43.0
    };

    const db = {
        susp: [
            { id: 'aug', name: 'Augmentin (Susp)', conc: 80, hospBasis: 45, hospFreq: 2, assocBasis: 90, 

assocFreq: 2, unit: 'mL', hospText: 'ä¸€èˆ¬æ„ŸæŸ“: 25 mg/kg BID; åš´é‡: 45 mg/kg BID', assocText: '80-90 mg 

amoxicillin/kg/dayï¼Œbid-tid (å»ºè­°æ¯”ä¾‹14:1ï¼Œé™¢å…§ç‚º7:1)' },
            { id: 'baktar', name: 'Sulfacotrim (Baktar)', conc: 8, isAgeBased: true, hospBasis: 0, hospFreq: 2, 

assocBasis: 10, assocFreq: 2, unit: 'mL', hospText: '6é€±-5æœˆ: 2.5ml BID; 6æœˆ-5æ­²: 5ml BID; 6-12æ­²: 10ml BID', 

assocText: 'é¦–é¸åæ‡‰ä¸ä½³æ™‚ TMP 6-12 mg/kg/day bid' },
            { id: 'zith', name: 'Zithromax', conc: 40, hospBasis: 10, hospFreq: 1, assocBasis: null, unit: 'mL', 

hospText: 'ä¸­è€³ç‚: 10 mg/kg (å–®æ¬¡æˆ–3å¤©); è‚ºç‚: D1 10mg/kg, D2-5 5mg/kg', assocText: '' },
            { id: 'ulexin', name: 'Ulexin (Cephalexin)', conc: 25, hospBasis: 50, hospFreq: 4, assocBasis: null, 

unit: 'mL', hospText: '<25kg: 25-50 mg/kg/day div 4; >25kg: 250-500mg Q6H', assocText: '' }
        ],
        pow: [
            { id: 'cexime', name: 'Cexime (Cefixime)', conc: 100, hospBasis: 8, hospFreq: 2, assocBasis: 10, 

assocFreq: 2, unit: 'é¡†', hospText: '<45kg: 8 mg/kg/day div 1-2; >45kg: 400 mg/day', assocText: '10 mg/kg/dayï¼Œ

bid' },
            { id: 'amox', name: 'Amoxicillin', conc: 500, hospBasis: 45, hospFreq: 3, assocBasis: 90, assocFreq: 

2, unit: 'é¡†', hospText: '<40kg: 40-45 mg/kg; >40kg: 500mg Q8H', assocText: '80-90 mg/kg/dayï¼Œbid-tid' },
            { id: 'ceflour', name: 'Ceflour (Cefuroxime)', conc: 250, hospBasis: 30, hospFreq: 2, assocBasis: 30, 

assocFreq: 2, unit: 'é¡†', hospText: '3 mo-12 yrs: 30 mg/kg/day bid', assocText: '30 mg/kg/dayï¼Œbid' },
            { id: 'acylo', name: 'Acylo (Acyclovir)', conc: 400, hospBasis: 80, hospFreq: 4, assocBasis: null, 

unit: 'é¡†', hospText: 'æ°´ç—˜: 20 mg/kg QID (Max 800mg)', assocText: '' },
            { id: 'doxy', name: 'Doxymycin', conc: 100, hospBasis: 4.4, hospFreq: 2, assocBasis: null, unit: 

'é¡†', hospText: '<45kg: 4.4 mg/kg/day bid; >45kg: 100mg bid', assocText: '' },
            { id: 'cino', name: 'Cinolone', conc: 250, hospBasis: 30, hospFreq: 2, assocBasis: null, unit: 'é¡†', 

hospText: '10-20 mg/kg Q12H (Max 750mg/dose)', assocText: '' }
        ]
    };

    let currentMode = 'susp';

    function switchTab(mode) {
        currentMode = mode;
        const btns = document.querySelectorAll('.tab-btn');
        if (mode === 'susp') {
            btns[0].classList.add('active');
            btns[1].classList.remove('active');
        } else {
            btns[0].classList.remove('active');
            btns[1].classList.add('active');
        }
        renderSelect();
        hideResult();
    }

    function renderSelect() {
        const select = document.getElementById('drug');
        select.innerHTML = '';
        db[currentMode].forEach((d, index) => {
            const opt = document.createElement('option');
            opt.value = index;
            opt.text = d.name;
            select.add(opt);
        });
    }

    function hideResult() {
        document.getElementById('results-container').querySelectorAll('.result-card').forEach(el => 

el.style.display = 'none');
        document.getElementById('guide-container').style.display = 'none';
        document.getElementById('estimate-msg').style.display = 'none';
    }

    // â˜… é«”é‡ä¼°ç®—åŠŸèƒ½
    function estimateWeight() {
        const age = parseFloat(document.getElementById('age').value);
        const weightInput = document.getElementById('weight');
        const msgDiv = document.getElementById('estimate-msg');
        
        if (!age || age <= 0) {
            alert("è«‹å…ˆè¼¸å…¥æœ‰æ•ˆçš„å¹´é½¡");
            return;
        }

        let estWeight = 0;
        let method = "";

        // 1. æŸ¥è¡¨ (0.5æ­² - 12æ­²)
        // ç‚ºäº†æ–¹ä¾¿ï¼Œå››æ¨äº”å…¥åˆ°æœ€è¿‘çš„æ•´æ•¸æˆ–0.5
        let lookupAge = age;
        if (age < 1) lookupAge = 0.5; // ä¸æ»¿1æ­²å…ˆå°æ‡‰åˆ°0.5
        else lookupAge = Math.round(age);

        if (growthChart[lookupAge]) {
            estWeight = growthChart[lookupAge];
            method = "å°ç£å…’ç«¥ç”Ÿé•·æ›²ç·š(50th)";
        } else if (age > 12) {
            // 2. è¶…é12æ­²ç”¨ç°¡å–®å…¬å¼ç²—ä¼°æˆ–æç¤º
            estWeight = (age * 2) + 8; // èˆŠå¼ç²—ä¼°å…¬å¼
            method = "ç°¡æ˜“å…¬å¼ä¼°ç®— (Age x 2 + 8)";
        } else {
             // è£œé–“æˆ–å…¶ä»–ç‹€æ³
             estWeight = (age * 2) + 8; 
             method = "ç°¡æ˜“å…¬å¼ä¼°ç®—";
        }

        weightInput.value = estWeight;
        msgDiv.innerText = `ğŸ’¡ å·²å¡«å…¥åƒè€ƒé«”é‡: ${estWeight} kg (${method})`;
        msgDiv.style.display = 'block';
        
        // å¦‚æœæ˜¯ Baktarï¼Œå› ç‚ºæ˜¯çœ‹å¹´é½¡ï¼Œä¸éœ€è¦ç‰¹åˆ¥å‹•ä½œï¼Œä½†å¦‚æœæ˜¯å…¶ä»–è—¥å“ï¼Œå¡«å…¥é«”é‡å¾Œä½¿ç”¨è€…å¯ä»¥ç›´æ¥æŒ‰è¨ˆç®—
    }

    function calculate() {
        const weight = parseFloat(document.getElementById('weight').value);
        const age = parseFloat(document.getElementById('age').value);
        const drugIdx = document.getElementById('drug').value;
        const drug = db[currentMode][drugIdx];

        if (!weight || weight <= 0) { alert('è«‹è¼¸å…¥æœ‰æ•ˆé«”é‡'); return; }

        // --- 1. è¨ˆç®—é™¢å…§å»ºè­° ---
        let hospDose = 0;
        let hospNote = '';
        
        if (drug.id === 'baktar') {
            if (isNaN(age)) { alert('Baktar éœ€è¼¸å…¥å¹´é½¡'); return; }
            if (age < 0.5) hospDose = 2.5;
            else if (age <= 5) hospDose = 5;
            else hospDose = 10;
        } 
        else if (drug.id === 'ulexin' && weight > 25) {
            hospDose = 10; hospNote = '(>25kgå›ºå®š)';
        }
        else if (currentMode === 'pow') {
            let dailyMg = weight * drug.hospBasis;
            let isAdult = false;
            // ç£¨ç²‰ä¸Šé™åˆ¤æ–·
            if (drug.id === 'cexime' && weight > 45) { dailyMg = 400; isAdult = true; }
            if (drug.id === 'amox' && weight >= 40) { dailyMg = 1500; isAdult = true; } 
            if (drug.id === 'doxy' && weight > 45) { dailyMg = 200; isAdult = true; }
            if (drug.id === 'acylo' && weight > 40) { dailyMg = 3200; isAdult = true; }

            hospDose = (dailyMg / drug.hospFreq) / drug.conc;
            if (isAdult) hospNote = '(æˆäººåŠ‘é‡)';
        }
        else {
            const dailyMg = weight * drug.hospBasis;
            hospDose = (dailyMg / drug.conc) / drug.hospFreq;
        }

        const hospDoseText = currentMode === 'pow' ? (Number.isInteger(hospDose) ? hospDose : hospDose.toFixed

(2)) : hospDose.toFixed(1);
        document.getElementById('val-hosp').innerText = hospDoseText + (hospNote ? "*" : "");
        document.getElementById('unit-hosp').innerText = drug.unit;
        
        let fTextH = drug.hospFreq === 1 ? 'QD' : (drug.hospFreq === 2 ? 'BID' : (drug.hospFreq === 3 ? 'TID' : 

'QID'));
        if (drug.id === 'ulexin') fTextH = 'Q6H';
        document.getElementById('freq-hosp').innerText = fTextH;
        document.getElementById('res-card-hosp').style.display = 'block';

        // --- 2. è¨ˆç®—é†«å­¸æœƒå»ºè­° ---
        const assocCard = document.getElementById('res-card-assoc');
        const assocBox = document.getElementById('text-assoc-box');
        
        if (drug.assocBasis) {
            const dailyMgAssoc = weight * drug.assocBasis;
            let assocDose = (dailyMgAssoc / drug.conc) / drug.assocFreq;
            
            if (currentMode === 'pow' && drug.id === 'cexime' && weight > 45) assocDose = 2; 
            
            const assocDoseText = currentMode === 'pow' ? (Number.isInteger(assocDose) ? assocDose : 

assocDose.toFixed(2)) : assocDose.toFixed(1);
            
            document.getElementById('val-assoc').innerText = assocDoseText;
            document.getElementById('unit-assoc').innerText = drug.unit;
            
            let fTextA = drug.assocFreq === 1 ? 'QD' : (drug.assocFreq === 2 ? 'BID' : (drug.assocFreq === 3 ? 

'TID' : 'QID'));
            document.getElementById('freq-assoc').innerText = fTextA;

            if (drug.id === 'aug') {
                document.getElementById('warning-assoc').innerText = "âš ï¸ ä¾ 90mg/kg è¨ˆç®—ã€‚é™¢å…§é…æ–¹æ¯”ä¾‹ 7:1ï¼Œè«‹

ç•™æ„è…¹ç€‰å‰¯ä½œç”¨ã€‚";
            } else {
                document.getElementById('warning-assoc').innerText = "";
            }

            assocCard.style.display = 'block';
            assocBox.style.display = 'block';
            document.getElementById('text-assoc').innerText = drug.assocText;
        } else {
            assocCard.style.display = 'none';
            assocBox.style.display = 'none';
        }

        document.getElementById('guide-container').style.display = 'block';
        document.getElementById('text-hosp').innerText = drug.hospText + (hospNote ? " " + hospNote : "");
    }

    renderSelect();
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
    }
</script>

</body>
</html>
