<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å°å…’åŠ‘é‡é€Ÿç®— (20251226ç‰ˆ)</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2980b9">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        body { font-family: "Microsoft JhengHei", -apple-system, sans-serif; background-color: #f4f7f6; margin: 0; padding: 0; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: white; min-height: 100vh; display: flex; flex-direction: column; }
        
        header { background: #2980b9; color: white; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        header h2 { margin: 0; font-size: 18px; display: flex; align-items: center; justify-content: center; gap: 8px; }

        .content { padding: 15px; flex: 1; }

        .tab-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { 
            flex: 1; padding: 12px; border: 1px solid #bdc3c7; background: #ecf0f1; color: #7f8c8d; 
            font-size: 16px; font-weight: bold; border-radius: 8px; cursor: pointer; transition: 0.2s;
        }
        .tab-btn.active { background: #3498db; color: white; border-color: #3498db; box-shadow: 0 3px 6px rgba(52, 152, 219, 0.3); }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #2c3e50; font-size: 15px; }
        select, input { width: 100%; padding: 12px; border: 1px solid #bdc3c7; border-radius: 8px; font-size: 16px; background: #fff; box-sizing: border-box; }
        select:focus, input:focus { border-color: #3498db; outline: none; }

        /* Tamiflu å°ˆç”¨ï¼šå¹´é½¡å±¤åˆ‡æ›æŒ‰éˆ• */
        .tamiflu-age-opt { display: none; flex-direction: row; gap: 10px; margin-bottom: 15px; }
        .tf-btn { flex: 1; padding: 10px; border: 1px solid #17a2b8; background: white; color: #17a2b8; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .tf-btn.active { background: #17a2b8; color: white; }

        .age-row { display: flex; gap: 10px; align-items: flex-end; }
        .age-input-group { flex: 1; }
        .estimate-btn { padding: 12px 10px; background-color: #17a2b8; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; height: 46px; white-space: nowrap; }
        #estimate-msg { font-size: 13px; color: #17a2b8; margin-top: 5px; display: none; }

        .calc-btn { width: 100%; padding: 14px; background: #e67e22; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 0 #d35400; }
        .calc-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #d35400; }

        .result-card { background-color: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 0; margin-top: 25px; display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.05); overflow: hidden; }
        .res-header { padding: 10px 15px; font-weight: bold; color: white; display: flex; justify-content: space-between; align-items: center; }
        .res-body { padding: 15px; display: flex; align-items: baseline; justify-content: space-between; }
        
        .res-hosp { background-color: #7f8c8d; }
        .res-assoc { background-color: #2980b9; }
        .res-tamiflu { background-color: #d35400; }

        .res-val { font-size: 32px; font-weight: bold; color: #333; }
        .res-unit { font-size: 16px; color: #666; margin-left: 5px; }
        .res-freq { background: #eee; padding: 4px 10px; border-radius: 15px; font-size: 14px; font-weight: bold; color: #555; }

        .note-warning { color: #c0392b; font-weight: bold; margin-top: 5px; font-size: 14px; display: block; padding: 0 15px 15px 15px; }

        .guide-box { margin-top: 20px; font-size: 13px; line-height: 1.5; color: #555; }
        .guide-item { margin-bottom: 15px; padding: 10px; background: #f9f9f9; border-left: 4px solid #ccc; border-radius: 4px; }
        .guide-title { display: block; font-weight: bold; margin-bottom: 5px; color: #333; }
        .guide-hosp-border { border-left-color: #7f8c8d; }
        .guide-assoc-border { border-left-color: #2980b9; background-color: #eaf2f8; }

        /* è¡¨æ ¼æ¨£å¼ */
        .info-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        .info-table th, .info-table td { border: 1px solid #bdc3c7; padding: 8px; text-align: left; vertical-align: middle; }
        .info-table th { background-color: #ecf0f1; text-align: center; font-weight: bold; color: #2c3e50; }
        .info-table tr:nth-child(even) { background-color: #f8f9fa; }
        .info-table td small { display: block; color: #7f8c8d; margin-top: 4px; font-size: 12px; }

        /* å…‹æµæ„Ÿå°ˆå±¬å€å¡Š (è¡¨æ ¼èˆ‡è…åŠŸèƒ½) */
        .tamiflu-ref-section { margin-top: 25px; display: none; }
        .ref-title { font-size: 15px; font-weight: bold; color: #d35400; border-left: 4px solid #d35400; padding-left: 8px; margin-bottom: 10px; }

        footer { text-align: center; padding: 20px; background: #eee; font-size: 12px; color: #aaa; margin-top: auto; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h2>
            <img src="icon.png" style="width: 28px; height: 28px; border-radius: 50%;" onerror="this.style.display='none'">
            å°å…’æŠ—ç”Ÿç´ é€Ÿç®—
        </h2>
    </header>

    <div class="content">
        <div class="tab-group">
            <button class="tab-btn active" onclick="switchTab('susp')">ğŸ’§ æ°´åŠ‘ (Susp)</button>
            <button class="tab-btn" onclick="switchTab('pow')">ğŸ’Š ç£¨ç²‰ (Cap/Tab)</button>
        </div>

        <div class="form-group">
            <label for="drug">é¸æ“‡è—¥å“</label>
            <select id="drug" onchange="handleDrugChange()"></select>
        </div>

        <div id="tamiflu-age-group" class="tamiflu-age-opt">
            <button class="tf-btn" onclick="setTamifluMode('infant')" id="btn-infant">æœªæ»¿ 1 æ­²</button>
            <button class="tf-btn active" onclick="setTamifluMode('child')" id="btn-child">1 æ­²ä»¥ä¸Š</button>
        </div>

        <div class="form-group">
            <label for="weight">é«”é‡ (kg)</label>
            <input type="number" id="weight" placeholder="è¼¸å…¥æˆ–è‡ªå‹•ä¼°ç®—" step="0.1" inputmode="decimal">
        </div>

        <div class="form-group">
            <label for="age">å¹´é½¡ (æ­²)</label>
            <div class="age-row">
                <div class="age-input-group">
                    <input type="number" id="age" placeholder="ä¾‹å¦‚ 5" inputmode="decimal">
                </div>
                <button class="estimate-btn" onclick="estimateWeight()">å¸¶å…¥æ¨™æº–é«”é‡</button>
            </div>
            <div id="estimate-msg"></div>
        </div>

        <button class="calc-btn" onclick="calculate()">è¨ˆç®—å»ºè­°åŠ‘é‡</button>

        <div id="results-container">
            <div id="res-card-hosp" class="result-card">
                <div class="res-header res-hosp">
                    <span>ğŸ¥ é™¢å…§å»ºè­°</span>
                    <small>Hospital Std.</small>
                </div>
                <div class="res-body">
                    <div><span class="res-val" id="val-hosp">--</span><span class="res-unit" id="unit-hosp">mL</span></div>
                    <div class="res-freq" id="freq-hosp">--</div>
                </div>
            </div>

            <div id="res-card-assoc" class="result-card" style="display:none;">
                <div class="res-header res-assoc">
                    <span>â˜… å…’ç§‘é†«å­¸æœƒå»ºè­° (2018)</span>
                    <small>High Dose</small>
                </div>
                <div class="res-body">
                    <div><span class="res-val" id="val-assoc">--</span><span class="res-unit" id="unit-assoc">mL</span></div>
                    <div class="res-freq" id="freq-assoc">--</div>
                </div>
                <span id="warning-assoc" class="note-warning"></span>
            </div>

            <div id="res-card-tamiflu" class="result-card" style="display:none;">
                <div class="res-header res-tamiflu">
                    <span>ğŸ¦  å…‹æµæ„Ÿèª¿é… (50mL)</span>
                    <small>Tamiflu</small>
                </div>
                <div class="res-body" style="display:block;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <span class="res-val" id="val-tamiflu">--</span>
                            <span class="res-unit">é¡† (75mg)</span>
                        </div>
                        <div class="res-freq">BID x 5å¤©</div>
                    </div>
                    <div style="margin-top:10px; font-size:14px; color:#555; background:#f0f0f0; padding:8px; border-radius:5px;">
                        ä½œæ³•: å‰å…¥ 50mL æ°´ä¸­<br>
                        ç”¨æ³•: æ¯æ¬¡å– <strong>5 mL</strong> (å–®æ¬¡åŠ‘é‡ <span id="dose-tamiflu-mg">--</span> mg)
                    </div>
                </div>
                <span id="warning-tamiflu" class="note-warning"></span>
            </div>

            <div class="guide-box" id="guide-container" style="display:none;">
                <div class="guide-item guide-assoc-border" id="text-assoc-box" style="display:none;">
                    <span class="guide-title" style="color:#2980b9">å…’ç§‘é†«å­¸æœƒå»ºè­°</span>
                    <span id="text-assoc"></span>
                </div>
                <div class="guide-item guide-hosp-border">
                    <span class="guide-title" style="color:#7f8c8d">é™¢å…§å»ºè­°åŠ‘é‡</span>
                    <span id="text-hosp"></span>
                </div>
            </div>
            
            <div id="tamiflu-ref-container" class="tamiflu-ref-section">
                <div id="tf-ref-child">
                    <div class="ref-title">ğŸ“Š é«”é‡èˆ‡å»ºè­°åŠ‘é‡å°ç…§è¡¨ (1æ­²ä»¥ä¸Š)</div>
                    <table class="info-table" style="margin-bottom: 25px;">
                        <thead><tr><th>é«”é‡</th><th>å»ºè­°åŠ‘é‡ (BID)</th></tr></thead>
                        <tbody>
                            <tr><td>â‰¤ 15 kg</td><td>30 mg</td></tr>
                            <tr><td>> 15 - 23 kg</td><td>45 mg</td></tr>
                            <tr><td>> 23 - 40 kg</td><td>60 mg</td></tr>
                            <tr><td>> 40 kg</td><td>75 mg</td></tr>
                        </tbody>
                    </table>
                </div>

                <div id="tf-ref-infant" style="display:none;">
                    <div class="ref-title">ğŸ‘¶ å¬°å…’å»ºè­°åŠ‘é‡å°ç…§è¡¨ (æœªæ»¿1æ­²)</div>
                    <table class="info-table" style="margin-bottom: 25px;">
                        <thead><tr><th>å¹´é½¡ / æ¢ä»¶</th><th>å»ºè­°åŠ‘é‡ (BID)</th></tr></thead>
                        <tbody>
                            <tr><td>0 - 12 å€‹æœˆ<br><small>(è¶³æœˆå…’)</small></td><td>3 mg / kg</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="ref-title">âš ï¸ è…åŠŸèƒ½åŠ‘é‡èª¿æ•´</div>
                <table class="info-table">
                    <thead><tr><th style="width: 40%">CrCl / æ¨¡å¼</th><th>å»ºè­°åŠ‘é‡</th></tr></thead>
                    <tbody>
                        <tr><td>> 60 mL/min</td><td>ä¸éœ€èª¿æ•´åŠ‘é‡</td></tr>
                        <tr><td>30-60 mL/min</td><td>30 mg BID<br><small>ç‚ºæœŸ 5 å¤©</small></td></tr>
                        <tr><td>10-30 mL/min</td><td>30 mg QD<br><small>ç‚ºæœŸ 5 å¤©</small></td></tr>
                        <tr><td>è¡€æ¶²é€æ</td><td>é€æå¾Œ 30 mg<br><small>å¯é€æå‰çµ¦è—¥</small></td></tr>
                        <tr><td>è…¹è†œé€æ</td><td>30 mg å–®æ¬¡åŠ‘é‡</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer>
        ä¿®æ”¹æ—¥æœŸ 20251226
    </footer>
</div>

<script>
    const growthChart = {
        0.5: 7.5, 1: 9.5, 2: 12.0, 3: 14.5, 4: 16.5, 5: 18.5, 6: 21.0, 
        7: 24.0, 8: 27.0, 9: 30.5, 10: 34.0, 11: 38.5, 12: 43.0
    };

    const db = {
        susp: [
            { id: 'aug', name: 'Augmentin (400/57)', conc: 80, hospBasis: 45, hospFreq: 2, assocBasis: 90, assocFreq: 2, unit: 'mL', hospText: 'ä¸€èˆ¬æ„ŸæŸ“: 25 mg/kg BID; åš´é‡: 45 mg/kg BID', assocText: '80-90 mg amoxicillin/kg/dayï¼Œbid-tid (å»ºè­°æ¯”ä¾‹14:1ï¼Œé™¢å…§ç‚º7:1)' },
            { id: 'baktar', name: 'Sulfacotrim (Baktar)', conc: 8, isAgeBased: true, hospBasis: 0, hospFreq: 2, assocBasis: 10, assocFreq: 2, unit: 'mL', hospText: '6é€±-5æœˆ: 2.5ml BID; 6æœˆ-5æ­²: 5ml BID; 6-12æ­²: 10ml BID', assocText: 'é¦–é¸åæ‡‰ä¸ä½³æ™‚ TMP 6-12 mg/kg/day bid' },
            { id: 'zith', name: 'Zithromax', conc: 40, hospBasis: 10, hospFreq: 1, assocBasis: null, unit: 'mL', hospText: 'ä¸­è€³ç‚: 10 mg/kg (å–®æ¬¡æˆ–3å¤©); è‚ºç‚: D1 10mg/kg, D2-5 5mg/kg', assocText: '' },
            { id: 'ulexin', name: 'Ulexin (Cephalexin)', conc: 25, hospBasis: 50, hospFreq: 4, assocBasis: null, unit: 'mL', hospText: '<25kg: 25-50 mg/kg/day div 4; >25kg: 250-500mg Q6H', assocText: '' }
        ],
        pow: [
            { id: 'cexime', name: 'Cexime (Cefixime)', conc: 100, hospBasis: 8, hospFreq: 2, assocBasis: 10, assocFreq: 2, unit: 'é¡†', hospText: '<45kg: 8 mg/kg/day div 1-2; >45kg: 400 mg/day', assocText: '10 mg/kg/dayï¼Œbid' },
            { id: 'amox', name: 'Amoxicillin', conc: 500, hospBasis: 45, hospFreq: 3, assocBasis: 90, assocFreq: 2, unit: 'é¡†', hospText: '<40kg: 40-45 mg/kg; >40kg: 500mg Q8H', assocText: '80-90 mg/kg/dayï¼Œbid-tid' },
            { id: 'ceflour', name: 'Ceflour (Cefuroxime)', conc: 250, hospBasis: 30, hospFreq: 2, assocBasis: 30, assocFreq: 2, unit: 'é¡†', hospText: '3 mo-12 yrs: 30 mg/kg/day bid', assocText: '30 mg/kg/dayï¼Œbid' },
            { id: 'acylo', name: 'Acylo (Acyclovir)', conc: 400, hospBasis: 80, hospFreq: 4, assocBasis: null, unit: 'é¡†', hospText: 'æ°´ç—˜: 20 mg/kg QID (Max 800mg)', assocText: '' },
            { id: 'doxy', name: 'Doxymycin', conc: 100, hospBasis: 4.4, hospFreq: 2, assocBasis: null, unit: 'é¡†', hospText: '<45kg: 4.4 mg/kg/day bid; >45kg: 100mg bid', assocText: '' },
            { id: 'cino', name: 'Cinolone', conc: 250, hospBasis: 30, hospFreq: 2, assocBasis: null, unit: 'é¡†', hospText: '10-20 mg/kg Q12H (Max 750mg/dose)', assocText: '' },
            // Tamiflu æ”¾åœ¨æœ€å¾Œä¸€å€‹
            { id: 'tamiflu', name: 'Tamiflu (å…‹æµæ„Ÿ)', type: 'special', unit: 'é¡†', hospText: '', assocText: '' }
        ]
    };

    let currentMode = 'susp';
    let tamifluAgeMode = 'child';

    function switchTab(mode) {
        currentMode = mode;
        const btns = document.querySelectorAll('.tab-btn');
        if (mode === 'susp') {
            btns[0].classList.add('active');
            btns[1].classList.remove('active');
        } else {
            btns[0].classList.remove('active');
            btns[1].classList.add('active');
        }
        renderSelect();
        hideResult();
        handleDrugChange();
    }

    function renderSelect() {
        const select = document.getElementById('drug');
        select.innerHTML = '';
        db[currentMode].forEach((d, index) => {
            const opt = document.createElement('option');
            opt.value = index;
            opt.text = d.name;
            select.add(opt);
        });
    }

    function handleDrugChange() {
        hideResult();
        const drugIdx = document.getElementById('drug').value;
        const drug = db[currentMode][drugIdx];
        
        const tfGroup = document.getElementById('tamiflu-age-group');
        const tfRef = document.getElementById('tamiflu-ref-container');

        if (drug.id === 'tamiflu') {
            tfGroup.style.display = 'flex';
            // é¸æ“‡ Tamiflu æ™‚ï¼Œè‹¥æœªè¨ˆç®—ï¼Œå¯é¸æ“‡æ˜¯å¦é å…ˆé¡¯ç¤ºè¡¨æ ¼ï¼Œæˆ–ç­‰è¨ˆç®—å¾Œé¡¯ç¤º
            // é€™è£¡è¨­å®šï¼šå°šæœªè¨ˆç®—ä¸é¡¯ç¤ºï¼Œç­‰æŒ‰è¨ˆç®—å¾Œæ‰é¡¯ç¤ºè¡¨æ ¼
            tfRef.style.display = 'none'; 
        } else {
            tfGroup.style.display = 'none';
            tfRef.style.display = 'none';
        }
    }

    function setTamifluMode(mode) {
        tamifluAgeMode = mode;
        document.getElementById('btn-infant').classList.toggle('active', mode === 'infant');
        document.getElementById('btn-child').classList.toggle('active', mode === 'child');
        calculate();
    }

    function hideResult() {
        document.getElementById('results-container').querySelectorAll('.result-card').forEach(el => el.style.display = 'none');
        document.getElementById('guide-container').style.display = 'none';
        document.getElementById('tamiflu-ref-container').style.display = 'none';
        document.getElementById('estimate-msg').style.display = 'none';
    }

    function estimateWeight() {
        const age = parseFloat(document.getElementById('age').value);
        const weightInput = document.getElementById('weight');
        const msgDiv = document.getElementById('estimate-msg');
        
        if (!age || age <= 0) { alert("è«‹å…ˆè¼¸å…¥æœ‰æ•ˆçš„å¹´é½¡"); return; }

        let estWeight = 0;
        let lookupAge = age;
        if (age < 1) lookupAge = 0.5;
        else lookupAge = Math.round(age);

        if (growthChart[lookupAge]) {
            estWeight = growthChart[lookupAge];
        } else {
             estWeight = (age * 2) + 8; 
        }
        weightInput.value = estWeight;
        msgDiv.innerText = `ğŸ’¡ å·²å¡«å…¥åƒè€ƒé«”é‡: ${estWeight} kg`;
        msgDiv.style.display = 'block';
    }

    function calculate() {
        const weight = parseFloat(document.getElementById('weight').value);
        const age = parseFloat(document.getElementById('age').value);
        const drugIdx = document.getElementById('drug').value;
        const drug = db[currentMode][drugIdx];

        if (!weight || weight <= 0) { alert('è«‹è¼¸å…¥æœ‰æ•ˆé«”é‡'); return; }

        // === ç‰¹æ®Šåˆ†æ”¯ï¼šTamiflu è¨ˆç®— ===
        if (drug.id === 'tamiflu') {
            let targetDoseMg = 0;
            let warning = "";

            if (tamifluAgeMode === 'infant') {
                if (weight > 10) {
                    warning = "âš ï¸ é«”é‡ > 10kg ä½†é¸æ“‡æœªæ»¿1æ­²ï¼Œä»¿å–®ç„¡å»ºè­°åŠ‘é‡ã€‚";
                } else {
                    targetDoseMg = weight * 3; 
                }
            } else {
                if (weight <= 15) targetDoseMg = 30;
                else if (weight <= 23) targetDoseMg = 45;
                else if (weight <= 40) targetDoseMg = 60;
                else targetDoseMg = 75;
            }

            let totalCaps = 0;
            if (targetDoseMg > 0) {
                totalCaps = (targetDoseMg * 10) / 75;
            }

            document.getElementById('val-tamiflu').innerText = Number.isInteger(totalCaps) ? totalCaps : totalCaps.toFixed(1);
            document.getElementById('dose-tamiflu-mg').innerText = targetDoseMg.toFixed(0);
            document.getElementById('warning-tamiflu').innerText = warning;
            
            // é¡¯ç¤º Tamiflu çµæœå¡
            document.getElementById('res-card-tamiflu').style.display = 'block';
            
            // é¡¯ç¤º Tamiflu å°ˆç”¨åƒè€ƒè¡¨å€å¡Š
            document.getElementById('tamiflu-ref-container').style.display = 'block';
            
            // åˆ‡æ›é¡¯ç¤ºå°æ‡‰çš„å¹´é½¡è¡¨
            if (tamifluAgeMode === 'infant') {
                document.getElementById('tf-ref-infant').style.display = 'block';
                document.getElementById('tf-ref-child').style.display = 'none';
            } else {
                document.getElementById('tf-ref-infant').style.display = 'none';
                document.getElementById('tf-ref-child').style.display = 'block';
            }

            document.getElementById('guide-container').style.display = 'none';
            return;
        }

        // === ä¸€èˆ¬è—¥å“è¨ˆç®— ===
        let hospDose = 0;
        let hospNote = '';
        
        if (drug.id === 'baktar') {
            if (isNaN(age)) { alert('Baktar éœ€è¼¸å…¥å¹´é½¡'); return; }
            if (age < 0.5) hospDose = 2.5;
            else if (age <= 5) hospDose = 5;
            else hospDose = 10;
        } 
        else if (drug.id === 'ulexin' && weight > 25) {
            hospDose = 10; hospNote = '(>25kgå›ºå®š)';
        }
        else if (currentMode === 'pow') {
            let dailyMg = weight * drug.hospBasis;
            let isAdult = false;
            if (drug.id === 'cexime' && weight > 45) { dailyMg = 400; isAdult = true; }
            if (drug.id === 'amox' && weight >= 40) { dailyMg = 1500; isAdult = true; } 
            if (drug.id === 'doxy' && weight > 45) { dailyMg = 200; isAdult = true; }
            if (drug.id === 'acylo' && weight > 40) { dailyMg = 3200; isAdult = true; }
            hospDose = (dailyMg / drug.hospFreq) / drug.conc;
            if (isAdult) hospNote = '(æˆäººåŠ‘é‡)';
        }
        else {
            const dailyMg = weight * drug.hospBasis;
            hospDose = (dailyMg / drug.conc) / drug.hospFreq;
        }

        const hospDoseText = currentMode === 'pow' ? (Number.isInteger(hospDose) ? hospDose : hospDose.toFixed(2)) : hospDose.toFixed(1);
        document.getElementById('val-hosp').innerText = hospDoseText + (hospNote ? "*" : "");
        document.getElementById('unit-hosp').innerText = drug.unit;
        
        let fTextH = drug.hospFreq === 1 ? 'QD' : (drug.hospFreq === 2 ? 'BID' : (drug.hospFreq === 3 ? 'TID' : 'QID'));
        if (drug.id === 'ulexin') fTextH = 'Q6H';
        document.getElementById('freq-hosp').innerText = fTextH;
        document.getElementById('res-card-hosp').style.display = 'block';

        const assocCard = document.getElementById('res-card-assoc');
        const assocBox = document.getElementById('text-assoc-box');
        
        if (drug.assocBasis) {
            const dailyMgAssoc = weight * drug.assocBasis;
            let assocDose = (dailyMgAssoc / drug.conc) / drug.assocFreq;
            
            if (currentMode === 'pow' && drug.id === 'cexime' && weight > 45) assocDose = 2; 
            
            const assocDoseText = currentMode === 'pow' ? (Number.isInteger(assocDose) ? assocDose : assocDose.toFixed(2)) : assocDose.toFixed(1);
            document.getElementById('val-assoc').innerText = assocDoseText;
            document.getElementById('unit-assoc').innerText = drug.unit;
            
            let fTextA = drug.assocFreq === 1 ? 'QD' : (drug.assocFreq === 2 ? 'BID' : (drug.assocFreq === 3 ? 'TID' : 'QID'));
            document.getElementById('freq-assoc').innerText = fTextA;

            if (drug.id === 'aug') {
                document.getElementById('warning-assoc').innerText = "âš ï¸ ä¾ 90mg/kg è¨ˆç®—ã€‚é™¢å…§é…æ–¹æ¯”ä¾‹ 7:1ï¼Œè«‹ç•™æ„è…¹ç€‰å‰¯ä½œç”¨ã€‚";
            } else {
                document.getElementById('warning-assoc').innerText = "";
            }

            assocCard.style.display = 'block';
            assocBox.style.display = 'block';
            document.getElementById('text-assoc').innerText = drug.assocText;
        } else {
            assocCard.style.display = 'none';
            assocBox.style.display = 'none';
        }

        document.getElementById('guide-container').style.display = 'block';
        document.getElementById('text-hosp').innerText = drug.hospText + (hospNote ? " " + hospNote : "");
    }

    renderSelect();
    handleDrugChange();
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
    }
</script>

</body>
</html>
